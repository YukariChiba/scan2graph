# scan2graph

Scan networks and extract their route & port information and features into graph network datasets.

## Requirements

- An usable Linux distribution.
- `prefix_trace.sh` requires `nmap` and `mtr`.

## Usage

### Acquire prefixes

1. Use `bgpq3` to extract prefixes of provided ASN.

```bash
bgpq3 ASXXXXXX
```

2. Use search engines and websites.

- bgp.he.net
- ipinfo.io
- routeviews.org
- atlas.ripe.net

### Scan networks

> This step ping and trace every IPs in selected network prefixes. And then scan open ports with fingerprints of pingable hosts.

Modify `prefix_trace.sh`. Set network prefixes to scan.

Run `prefix_trace.sh`.

Result files are located at `data/<Year>/<Month>/<Day>/<IP>.*.txt`

- `<IP>.path.txt`: Route paths.
- `<IP>.nmap.txt`: Port scan and related info.

### Collect path info

> This step collect route information from route paths and generate edge lists.

Run `collect_route.sh`.

Result files are located at `data_extracted/<Year>/<Month>/<Day>/paths.processed.csv`

### Extract features

> This steps extract port status and fingerprint features of known services from results.

Modify `collect_feature.sh`. Add workflow code for well-known ports and services.

Run `collect_feature.sh`.

A table of opened ports is located at `data_extracted/<Year>/<Month>/<Day>/ports.csv`:

```csv
<IP1> <PORT1> <PORT2> <PORT3> ...
<IP2> <PORT1> <PORT2> <PORT3> ...
...
```

A table of fingerprint/feature information for each ports is located at `data_extracted/<Year>/<Month>/<Day>/<Port>.csv`:

(22 SSH as example)
```csv
<IP1> <PUBKEY1ID> <PUBKEY2ID> <PUBKEY3ID> ...
<IP2> <PUBKEY1ID> <PUBKEY2ID> <PUBKEY3ID> ...
...
```

Each feature item has an unique ID generated by a database located in `db/<feature>.db`, which allows one-hot vector generation later for datasets.

## TODO

- [ ] Use `db/ip.db` to record and assign an ID for each IP address.
- [ ] Extract features from more services, eg. RDP, Web, Telnet, FTP.
- [ ] Generate dataset with fully one-hot vector.
- [ ] Generate example data for high-quality honeypot.